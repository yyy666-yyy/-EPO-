<!DOCTYPE html>
<html lang="zh-CN">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>ç ´è¯‘â€œçº¢è‰²å¯†ç â€â€”EPOå…´å¥‹å‰‚çš„ç§‘å­¦çœŸç›¸ä¸é’å°‘å¹´è¿åŠ¨å‘˜çš„æŠ‰æ‹©</title>
Â  <style>
Â  Â  html, body {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  overflow: hidden;
Â  Â  Â  background: #000;
Â  Â  Â  font-family: "Comic Sans MS", "Arial Rounded MT Bold", cursive;
Â  Â  }
Â  Â  video {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  object-fit: cover;
Â  Â  Â  z-index: 1;
Â  Â  }

Â  Â  /* --- ADDED FOR MOBILE PLAYBACK --- */
Â  Â  #start-overlay {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.9); /* Dark overlay */
Â  Â  Â  z-index: 10000; /* On top of everything */
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  #start-button {
Â  Â  Â  padding: 20px 40px;
Â  Â  Â  font-size: 24px;
Â  Â  Â  color: #000;
Â  Â  Â  background-color: #ffff00; /* Match the "blackboard" button style */
Â  Â  Â  border: 3px solid #ff0000;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-family: inherit; /* Use the same comic-style font */
Â  Â  Â  box-shadow: 0 5px #ff0000;
Â  Â  Â  animation: pulse 1.5s infinite;
Â  Â  }
Â  Â  @keyframes pulse {
Â  Â  Â  0% { transform: scale(1); }
Â  Â  Â  50% { transform: scale(1.05); }
Â  Â  Â  100% { transform: scale(1); }
Â  Â  }
Â  Â  /* --- END OF ADDED CSS --- */

Â  Â  /* Original Popup Styles */
Â  Â  .popup-box {
Â  Â  Â  display: none;
Â  Â  Â  position: fixed;
Â  Â  Â  top: 20%;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  width: 90%;
Â  Â  Â  max-width: 440px;
Â  Â  Â  padding: 24px;
Â  Â  Â  background: linear-gradient(to bottom, #fdfdfd, #fef2d8);
Â  Â  Â  border: 6px solid #ff0000;
Â  Â  Â  border-radius: 24px;
Â  Â  Â  box-shadow: 0 0 12px 6px rgba(0,0,0,0.25), inset 0 0 6px #000;
Â  Â  Â  z-index: 10;
Â  Â  Â  animation: pop-in 0.4s ease-out;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  .popup-box h2 {
Â  Â  Â  font-size: 22px;
Â  Â  Â  color: #0033cc;
Â  Â  Â  text-shadow: 2px 2px #fff;
Â  Â  }
Â  Â  .popup-box button {
Â  Â  Â  margin-top: 15px;
Â  Â  Â  padding: 12px 24px;
Â  Â  Â  background-color: #ffcc00;
Â  Â  Â  border: 3px solid #000;
Â  Â  Â  border-radius: 16px;
Â  Â  Â  color: #000;
Â  Â  Â  font-weight: bold;
Â  Â  Â  font-size: 16px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.2s;
Â  Â  Â  box-shadow: 0 4px #cc9900;
Â  Â  }
Â  Â  .popup-box button:hover {
Â  Â  Â  background-color: #ffdd44;
Â  Â  Â  transform: scale(1.05);
Â  Â  }
Â  Â  .quiz-box button {
Â  Â  Â  display: block;
Â  Â  Â  margin: 10px auto;
Â  Â  Â  width: 80%;
Â  Â  }
Â  Â  #feedback {
Â  Â  Â  margin-top: 12px;
Â  Â  Â  font-size: 18px;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  @keyframes pop-in {
Â  Â  Â  from {
Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  transform: scale(0.7) translateX(-50%);
Â  Â  Â  }
Â  Â  Â  to {
Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  transform: scale(1) translateX(-50%);
Â  Â  Â  }
Â  Â  }
Â  Â  .confetti {
Â  Â  Â  position: fixed;
Â  Â  Â  width: 12px;
Â  Â  Â  height: 12px;
Â  Â  Â  background-color: #ffcc00;
Â  Â  Â  top: -20px;
Â  Â  Â  animation: fall 3s linear infinite;
Â  Â  Â  z-index: 999;
Â  Â  Â  border-radius: 50%;
Â  Â  }
Â  Â  @keyframes fall {
Â  Â  Â  to {
Â  Â  Â  Â  transform: translateY(110vh) rotate(360deg);
Â  Â  Â  Â  opacity: 0;
Â  Â  Â  }
Â  Â  }

Â  Â  #qr-container {
Â  Â  Â  display: none;
Â  Â  Â  position: fixed;
Â  Â  Â  top: 50%;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  background: #fff;
Â  Â  Â  padding: 0;
Â  Â  Â  border: 6px solid #0033cc;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  text-align: center;
Â  Â  Â  z-index: 999;
Â  Â  }

Â  Â  #qr-container img {
Â  Â  Â  display: block;
Â  Â  Â  max-width: 100%;
Â  Â  Â  max-height: 100%;
Â  Â  }

Â  Â  #qr-download {
Â  Â  Â  display: inline-block;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  background: #ff3333;
Â  Â  Â  color: white;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-weight: bold;
Â  Â  Â  border: 2px solid #000;
Â  Â  Â  margin-top: 10px;
Â  Â  }

Â  Â  #qr-download:hover {
Â  Â  Â  background: #ff6666;
Â  Â  }

Â  Â  #qr-container button {
Â  Â  Â  display: block;
Â  Â  Â  margin: 10px auto;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  background: #0033cc;
Â  Â  Â  color: white;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  border: 2px solid #000;
Â  Â  Â  font-weight: bold;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  #qr-container button:hover {
Â  Â  Â  background: #0055ff;
Â  Â  }

Â  Â  /* New Blackboard Popup Styles */
Â  Â  .blackboard-popup {
Â  Â  Â  Â  display: none;
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.8);
Â  Â  Â  Â  z-index: 20;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  color: #FFF;
Â  Â  Â  Â  font-family: inherit;
Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  }

Â  Â  .blackboard {
Â  Â  Â  Â  background-color: #000;
Â  Â  Â  Â  border: 10px solid #ff0000;
Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  box-shadow: 0 0 15px 5px #ff0000;
Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  max-width: 700px;
Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  animation: pop-in 0.5s ease-out;
Â  Â  }

Â  Â  .blackboard-title {
Â  Â  Â  Â  font-size: 28px;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  color: #ffff00;
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  text-shadow: 2px 2px #ff0000;
Â  Â  }

Â  Â  .blackboard-content {
Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  color: #FFF;
Â  Â  }
Â  Â  .blackboard-content strong {
Â  Â  Â  Â  display: block;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  color: #ffff00;
Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  .blackboard-button {
Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  background-color: #ffff00;
Â  Â  Â  Â  color: #000;
Â  Â  Â  Â  border: 3px solid #ff0000;
Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  box-shadow: 0 5px #ff0000;
Â  Â  }

Â  Â  .blackboard-button:hover {
Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  color: #ff0000;
Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  box-shadow: 0 7px #ff0000;
Â  Â  }

Â  Â  /* Animated Character Styles */
Â  Â  .animated-character {
Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  bottom: 20px;
Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  width: 100px;
Â  Â  Â  Â  height: 150px;
Â  Â  Â  Â  background-image: url('anime-character.png');
Â  Â  Â  Â  background-size: contain;
Â  Â  Â  Â  background-repeat: no-repeat;
Â  Â  Â  Â  background-position: center;
Â  Â  Â  Â  border: none;
Â  Â  Â  Â  animation: character-bob 2s ease-in-out infinite;
Â  Â  }

Â  Â  /* Simple Bobbing Animation */
Â  Â  @keyframes character-bob {
Â  Â  Â  Â  0%, 100% {
Â  Â  Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  }
Â  Â  Â  Â  50% {
Â  Â  Â  Â  Â  Â  transform: translateY(-10px);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  /* Quiz Styles */
Â  Â  .quiz-container {
Â  Â  Â  Â  max-height: 70vh;
Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  padding-right: 15px; /* For scrollbar */
Â  Â  }
Â  Â  .quiz-question-box {
Â  Â  Â  Â  background-color: #1a1a1a;
Â  Â  Â  Â  border: 2px solid #ffff00;
Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  text-align: left;
Â  Â  }
Â  Â  .quiz-question-box p {
Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  font-size: 18px;
Â  Â  }
Â  Â  .quiz-option {
Â  Â  Â  Â  display: block;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  margin: 8px 0;
Â  Â  Â  Â  background-color: #ff0000;
Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  border: 2px solid #ffff00;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  }
Â  Â  .quiz-option:hover {
Â  Â  Â  Â  background-color: #cc0000;
Â  Â  }
Â  Â  .quiz-feedback {
Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  font-size: 16px;
Â  Â  }
Â  Â  .correct {
Â  Â  Â  Â  color: #00ff00;
Â  Â  }
Â  Â  .incorrect {
Â  Â  Â  Â  color: #ff0000;
Â  Â  }
Â  Â  .quiz-navigation {
Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  color: #ffff00;
Â  Â  }

Â  Â  /* Celebration Effect */
Â  Â  #celebration {
Â  Â  Â  Â  display: none;
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  background: rgba(0,0,0,0.7);
Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  flex-direction: column;
Â  Â  }
Â  Â  #celebration h2 {
Â  Â  Â  Â  color: #ffff00;
Â  Â  Â  Â  font-size: 3em;
Â  Â  Â  Â  text-shadow: 3px 3px #ff0000;
Â  Â  Â  Â  animation: celebration-text 1s ease-in-out infinite alternate;
Â  Â  }
Â  Â  @keyframes celebration-text {
Â  Â  Â  Â  from { transform: scale(1); }
Â  Â  Â  Â  to { transform: scale(1.1); }
Â  Â  }

Â  </style>
</head>
<body>

<video id="video" controls playsinline webkit-playsinline>
Â  Â  <source src="ç ´è¯‘çº¢è‰²å¯†ç EPO.mp4" type="video/mp4" />
Â  ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚
</video>

<div id="start-overlay">
  <button id="start-button">ç‚¹å‡»å¼€å§‹æ’­æ”¾</button>
</div>

<div id="popup" class="popup-box">
Â  <h2>ç‚¹å‡»æ­å¼€EPOçœŸç›¸ï¼</h2>
Â  <button onclick="closePopup()">å¼€å§‹å§ï¼</button>
</div>
<div id="quiz" class="popup-box quiz-box">
Â  <h2>å…³äºEPOï¼ˆä¿ƒçº¢ç»†èƒç”Ÿæˆç´ ï¼‰çš„æè¿°ï¼Œä»¥ä¸‹è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼š</h2>
Â  <button onclick="checkAnswer('A')">A. EPOæ˜¯ä¸€ç§åˆæ³•çš„è¿åŠ¨è¾…åŠ©è¯ç‰©ï¼Œå¯ä»¥å®‰å…¨åœ°ç”¨äºæé«˜è¿åŠ¨è¡¨ç°ã€‚</button>
Â  <button onclick="checkAnswer('B')">B. EPOèƒ½å¤Ÿåˆºæ¿€éª¨é«“åˆ¶é€ æ›´å¤šçš„çº¢ç»†èƒï¼Œä»è€Œå¢åŠ è¡€æ¶²çš„æºæ°§èƒ½åŠ›ã€‚</button>
Â  <button onclick="checkAnswer('C')">C. ä½¿ç”¨EPOä¸ä¼šå¯¹èº«ä½“é€ æˆä»»ä½•å‰¯ä½œç”¨ï¼Œæ˜¯ä¸€ç§ç†æƒ³çš„è€åŠ›å¢å¼ºå‰‚ã€‚</button>
Â  <button onclick="checkAnswer('D')">D. EPOçš„ä½¿ç”¨å¯¹è¿åŠ¨å‘˜æ¥è¯´åªæœ‰å¥½å¤„ï¼Œæ²¡æœ‰åå¤„ã€‚</button>
Â  <p id="feedback"></p>
</div>
<div id="finalPopup" class="popup-box">
Â  <h2>æ‹’ç»çº¢è‰²è¯±æƒ‘ï¼Œåšå®ˆå…¬å¹³ä¿¡ä»°</h2>
Â  <button onclick="showCommitment()">æˆ‘æ‰¿è¯ºï¼</button>
</div>
<div id="commitmentPopup" class="popup-box">
Â  <h2>å·²æˆåŠŸç­¾ç½²ç”µå­æ‰¿è¯ºä¹¦</h2>
Â  <button onclick="closeCommitment()">ç‚¹å‡»åŠ å…¥â€œSay No è¡ŒåŠ¨â€ï¼</button>
</div>
<div id="qr-container">
Â  <h2>æ­å–œä½ è·å¾—ã€ŒåEPOå¾½ç« ã€ï¼</h2>
Â  <img src="badge-image(1).png" alt="æ‰«æé¢†å–å¾½ç« ">
Â  <a id="qr-download" href="badge-image.png" download="åEPOå¾½ç« .png">ğŸ“¥ æ‰«ç é¢†å–æˆ–ç‚¹å‡»ä¸‹è½½å¾½ç« </a>
Â  <button onclick="closeQr()">è¿”å›è§†é¢‘</button>
</div>

<div id="knowledgePopup1" class="blackboard-popup">
Â  <div class="blackboard">
Â  Â  <h2 class="blackboard-title">ã€ŠEPOçš„ç§‘å­¦çœŸç›¸ã€‹</h2>
Â  Â  <div class="blackboard-content" data-speech="çŸ¥è¯†ç‚¹ä¸€ï¼šEPOçš„â€œä¸ªäººåç‰‡â€ã€‚ä¿ƒçº¢ç»†èƒç”Ÿæˆç´ ï¼ˆEPOï¼‰åˆç§°çº¢ç»†èƒåˆºæ¿€å› å­ã€ä¿ƒçº¢ç´ ï¼Œæ˜¯ä¸€ç§äººä½“å†…æºæ€§ç³–è›‹ç™½æ¿€ç´ ï¼Œå¯åˆºæ¿€çº¢ç»†èƒç”Ÿæˆã€‚">
Â  Â  Â  <strong>çŸ¥è¯†ç‚¹ä¸€ï¼šEPOçš„â€œä¸ªäººåç‰‡â€</strong>
Â  Â  Â  ä¿ƒçº¢ç»†èƒç”Ÿæˆç´ ï¼ˆEPOï¼‰åˆç§°çº¢ç»†èƒåˆºæ¿€å› å­ã€ä¿ƒçº¢ç´ ï¼Œæ˜¯ä¸€ç§äººä½“å†…æºæ€§ç³–è›‹ç™½æ¿€ç´ ï¼Œå¯åˆºæ¿€çº¢ç»†èƒç”Ÿæˆã€‚
Â  Â  </div>
Â  Â  <div class="animated-character"></div>
Â  Â  <button class="blackboard-button" onclick="closeKnowledgePopup('knowledgePopup1')">å·²Getï¼ç»§ç»­æ’­æ”¾</button>
Â  </div>
</div>

<div id="knowledgePopup2" class="blackboard-popup">
Â  <div class="blackboard">
Â  Â  <h2 class="blackboard-title">ã€ŠEPOçš„ç§‘å­¦çœŸç›¸ã€‹</h2>
Â  Â  <div class="blackboard-content" data-speech="çŸ¥è¯†ç‚¹äºŒï¼šEPOçš„ä½œç”¨æœºç†ã€‚EPOä¸»è¦é€šè¿‡ä¸çº¢ç³»ç¥–ç»†èƒè¡¨é¢çš„ç‰¹å¼‚æ€§å—ä½“â€œé”é’¥ç»“åˆâ€æ¥å‘æŒ¥å…¶ç”Ÿç‰©æ´»æ€§ã€‚">
Â  Â  Â  <strong>çŸ¥è¯†ç‚¹äºŒï¼šEPOçš„ä½œç”¨æœºç†</strong>
Â  Â  Â  EPOä¸»è¦é€šè¿‡ä¸çº¢ç³»ç¥–ç»†èƒè¡¨é¢çš„ç‰¹å¼‚æ€§å—ä½“â€œé”é’¥ç»“åˆâ€æ¥å‘æŒ¥å…¶ç”Ÿç‰©æ´»æ€§ã€‚
Â  Â  </div>
Â  Â  <div class="animated-character"></div>
Â  Â  <button class="blackboard-button" onclick="closeKnowledgePopup('knowledgePopup2')">å·²Getï¼ç»§ç»­æ’­æ”¾</button>
Â  </div>
</div>

<div id="knowledgePopup3" class="blackboard-popup">
Â  <div class="blackboard">
Â  Â  <h2 class="blackboard-title">ã€ŠEPOçš„ç§‘å­¦çœŸç›¸ã€‹</h2>
Â  Â  <div class="blackboard-content" data-speech="çŸ¥è¯†ç‚¹ä¸‰ï¼šEPOæ»¥ç”¨çš„ä»£ä»·ã€‚EPOæ»¥ç”¨ä¼šå¯¼è‡´ä¸¥é‡çš„å¥åº·é£é™©ï¼ŒåŒ…æ‹¬è¡€æ¶²çº¢ç»†èƒè¿‡å¤šï¼Œè¡€å‹è¿‡é«˜ï¼Œå¿ƒè„ç—…ã€ä¸­é£ç­‰ä¸€ç³»åˆ—æ— æ³•æŒ½å›çš„åæœã€‚">
Â  Â  Â  <strong>çŸ¥è¯†ç‚¹ä¸‰ï¼šEPOæ»¥ç”¨çš„ä»£ä»·</strong>
Â  Â  Â  EPOæ»¥ç”¨ä¼šå¯¼è‡´ä¸¥é‡çš„å¥åº·é£é™©ï¼ŒåŒ…æ‹¬è¡€æ¶²çº¢ç»†èƒè¿‡å¤šï¼Œè¡€å‹è¿‡é«˜ï¼Œå¿ƒè„ç—…ã€ä¸­é£ç­‰ä¸€ç³»åˆ—æ— æ³•æŒ½å›çš„åæœã€‚
Â  Â  </div>
Â  Â  <div class="animated-character"></div>
Â  Â  <button class="blackboard-button" onclick="closeKnowledgePopup('knowledgePopup3')">å·²Getï¼ç»§ç»­æ’­æ”¾</button>
Â  </div>
</div>

<div id="summaryPopup" class="blackboard-popup">
Â  <div class="blackboard">
Â  Â  <h2 class="blackboard-title">ã€Šè¯¾å ‚å°ç»“ã€‹</h2>
Â  Â  <div class="blackboard-content" data-speech="è¯¾å ‚å°ç»“ã€‚çŸ¥è¯†ç‚¹ä¸€ã€EPOçš„â€œä¸ªäººåç‰‡â€ï¼šä¿ƒçº¢ç»†èƒç”Ÿæˆç´ ï¼ˆEPOï¼‰åˆç§°çº¢ç»†èƒåˆºæ¿€å› å­ã€ä¿ƒçº¢ç´ ï¼Œæ˜¯ä¸€ç§äººä½“å†…æºæ€§ç³–è›‹ç™½æ¿€ç´ ï¼Œå¯åˆºæ¿€çº¢ç»†èƒç”Ÿæˆã€‚çŸ¥è¯†ç‚¹äºŒã€EPOçš„ä½œç”¨æœºç†ï¼šEPOä¸»è¦é€šè¿‡ä¸çº¢ç³»ç¥–ç»†èƒè¡¨é¢çš„ç‰¹å¼‚æ€§å—ä½“â€œé”é’¥ç»“åˆâ€æ¥å‘æŒ¥å…¶ç”Ÿç‰©æ´»æ€§ã€‚çŸ¥è¯†ç‚¹ä¸‰ã€EPOæ»¥ç”¨çš„ä»£ä»·ï¼šEPOæ»¥ç”¨ä¼šå¯¼è‡´ä¸¥é‡çš„å¥åº·é£é™©ï¼ŒåŒ…æ‹¬è¡€æ¶²çº¢ç»†èƒè¿‡å¤šï¼Œè¡€å‹è¿‡é«˜ï¼Œå¿ƒè„ç—…ã€ä¸­é£ç­‰ä¸€ç³»åˆ—æ— æ³•æŒ½å›çš„åæœã€‚">
Â  Â  Â  <strong>çŸ¥è¯†ç‚¹ä¸€ã€EPOçš„â€œä¸ªäººåç‰‡â€ï¼š</strong>ä¿ƒçº¢ç»†èƒç”Ÿæˆç´ ï¼ˆEPOï¼‰åˆç§°çº¢ç»†èƒåˆºæ¿€å› å­ã€ä¿ƒçº¢ç´ ï¼Œæ˜¯ä¸€ç§äººä½“å†…æºæ€§ç³–è›‹ç™½æ¿€ç´ ï¼Œå¯åˆºæ¿€çº¢ç»†èƒç”Ÿæˆã€‚<br><br>
Â  Â  Â  <strong>çŸ¥è¯†ç‚¹äºŒã€EPOçš„ä½œç”¨æœºç†ï¼š</strong>EPOä¸»è¦é€šè¿‡ä¸çº¢ç³»ç¥–ç»†èƒè¡¨é¢çš„ç‰¹å¼‚æ€§å—ä½“â€œé”é’¥ç»“åˆâ€æ¥å‘æŒ¥å…¶ç”Ÿç‰©æ´»æ€§ã€‚<br><br>
Â  Â  Â  <strong>çŸ¥è¯†ç‚¹ä¸‰ã€EPOæ»¥ç”¨çš„ä»£ä»·ï¼š</strong>EPOæ»¥ç”¨ä¼šå¯¼è‡´ä¸¥é‡çš„å¥åº·é£é™©ï¼ŒåŒ…æ‹¬è¡€æ¶²çº¢ç»†èƒè¿‡å¤šï¼Œè¡€å‹è¿‡é«˜ï¼Œå¿ƒè„ç—…ã€ä¸­é£ç­‰ä¸€ç³»åˆ—æ— æ³•æŒ½å›çš„åæœã€‚
Â  Â  </div>
Â  Â  <div class="animated-character"></div>
Â  Â  <button class="blackboard-button" onclick="closeKnowledgePopup('summaryPopup')">å·²Getå…¨éƒ¨è¯¾å ‚çŸ¥è¯†ç‚¹ï¼ç»§ç»­æ’­æ”¾</button>
Â  </div>
</div>

<div id="finalQuizPopup" class="blackboard-popup">
Â  <div class="blackboard">
Â  Â  <h2 class="blackboard-title">è¯¾å ‚ç»ƒä¹ </h2>
Â  Â  <div class="quiz-container" id="quizContainer">
Â  Â  Â  Â  Â  </div>
Â  Â  <button class="blackboard-button" id="quizCloseButton" style="display: none;" onclick="closeKnowledgePopup('finalQuizPopup')">å®Œæˆç»ƒä¹ ï¼ç»§ç»­è§‚çœ‹</button>
Â  </div>
</div>

<div id="celebration">
Â  Â  <h2>æ­å–œä½ ï¼ï¼ï¼</h2>
Â  Â  <p style="color: white; font-size: 1.5em;">ä½ å·²å®Œæˆå…¨éƒ¨è¯¾å ‚å†…å®¹å’Œä¹ é¢˜ï¼</p>
</div>

<script>
Â  const video = document.getElementById("video");
Â  // Original popup elements
Â  const popup = document.getElementById("popup");
Â  const quiz = document.getElementById("quiz");
Â  const finalPopup = document.getElementById("finalPopup");
Â  const commitmentPopup = document.getElementById("commitmentPopup");
Â  const feedback = document.getElementById("feedback");
Â  const qrContainer = document.getElementById("qr-container");
Â  const qrDownload = document.getElementById("qr-download");

Â  // New popup elements
Â  const knowledgePopup1 = document.getElementById("knowledgePopup1");
Â  const knowledgePopup2 = document.getElementById("knowledgePopup2");
Â  const knowledgePopup3 = document.getElementById("knowledgePopup3");
Â  const summaryPopup = document.getElementById("summaryPopup");
Â  const finalQuizPopup = document.getElementById("finalQuizPopup");
Â  const quizContainer = document.getElementById("quizContainer");
Â  const quizCloseButton = document.getElementById("quizCloseButton");
Â  const celebrationEffect = document.getElementById("celebration");
 
Â  // --- ADDED FOR MOBILE PLAYBACK ---
Â  const startOverlay = document.getElementById("start-overlay");
Â  const startButton = document.getElementById("start-button");
Â  // --- END OF ADDED VARS ---

Â  // Tracking variables for original popups
Â  let popupShown = false;
Â  let quizShown = false;
Â  let finalPopupShown = false;
Â  let firstQRTriggered = false;
Â  let hasInteractedWithQR = false;
Â  let lastVideoTime = 0;

Â  // Tracking variables for new popups
Â  let knowledgePopup1Shown = false;
Â  let knowledgePopup2Shown = false;
Â  let knowledgePopup3Shown = false;
Â  let summaryPopupShown = false;
Â  let finalQuizPopupShown = false;

Â  // --- Speech Synthesis Setup ---
Â  const synth = window.speechSynthesis;
Â  let voices = [];
Â  let speechUtterance = null; // To hold the current utterance

Â  function populateVoiceList() {
Â  Â  if(typeof speechSynthesis === 'undefined') {
Â  Â  Â  console.warn('Speech Synthesis not supported');
Â  Â  Â  return;
Â  Â  }
Â  Â  voices = synth.getVoices().filter(voice => voice.lang.startsWith('zh'));
Â  Â  // console.log(voices); // Optional: Log available Chinese voices
Â  }

Â  populateVoiceList();
Â  if (typeof speechSynthesis !== 'undefined' && speechSynthesis.onvoiceschanged !== undefined) {
Â  Â  speechSynthesis.onvoiceschanged = populateVoiceList;
Â  }

Â  // --- Quiz Data --- 
Â  const quizData = [
Â  Â  {
Â  Â  Â  type: 'choice',
Â  Â  Â  question: 'å…³äºEPOï¼ˆä¿ƒçº¢ç»†èƒç”Ÿæˆç´ ï¼‰çš„æè¿°ï¼Œä»¥ä¸‹è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼š',
Â  Â  Â  options: [
Â  Â  Â  Â  'A. EPOæ˜¯ä¸€ç§åˆæ³•çš„è¿åŠ¨è¾…åŠ©è¯ç‰©ï¼Œå¯ä»¥å®‰å…¨åœ°ç”¨äºæé«˜è¿åŠ¨è¡¨ç°ã€‚',
Â  Â  Â  Â  'B. EPOèƒ½å¤Ÿåˆºæ¿€éª¨é«“åˆ¶é€ æ›´å¤šçš„çº¢ç»†èƒï¼Œä»è€Œå¢åŠ è¡€æ¶²çš„æºæ°§èƒ½åŠ›ã€‚',
Â  Â  Â  Â  'C. ä½¿ç”¨EPOä¸ä¼šå¯¹èº«ä½“é€ æˆä»»ä½•å‰¯ä½œç”¨ï¼Œæ˜¯ä¸€ç§ç†æƒ³çš„è€åŠ›å¢å¼ºå‰‚ã€‚',
Â  Â  Â  Â  'D. EPOçš„ä½¿ç”¨å¯¹è¿åŠ¨å‘˜æ¥è¯´åªæœ‰å¥½å¤„ï¼Œæ²¡æœ‰åå¤„ã€‚'
Â  Â  Â  ],
Â  Â  Â  answer: 'B',
Â  Â  Â  explanation: 'Bé€‰é¡¹æ­£ç¡®æè¿°äº†EPOçš„ä¸»è¦ç”Ÿç†åŠŸèƒ½ã€‚Aé€‰é¡¹é”™è¯¯ï¼ŒEPOå±äºå…´å¥‹å‰‚ï¼Œæ˜¯è¢«ç¦æ­¢çš„ï¼›Cå’ŒDé€‰é¡¹é”™è¯¯ï¼Œæ»¥ç”¨EPOæœ‰ä¸¥é‡çš„å¥åº·é£é™©ã€‚'
Â  Â  },
Â  Â  {
Â  Â  Â  type: 'choice',
Â  Â  Â  question: 'EPOçš„åˆ«åä¸åŒ…æ‹¬ï¼š',
Â  Â  Â  options: [
Â  Â  Â  Â  'A. ä¿ƒçº¢ç´ ',
Â  Â  Â  Â  'B. çº¢ç»†èƒåˆºæ¿€å› å­',
Â  Â  Â  Â  'C. ç”Ÿé•¿æ¿€ç´ ',
Â  Â  Â  Â  'D. ä¿ƒçº¢ç»†èƒç”Ÿæˆç´ '
Â  Â  Â  ],
Â  Â  Â  answer: 'C',
Â  Â  Â  explanation: 'æ ¹æ®çŸ¥è¯†ç‚¹ä¸€ï¼ŒEPOçš„åˆ«ååŒ…æ‹¬çº¢ç»†èƒåˆºæ¿€å› å­å’Œä¿ƒçº¢ç´ ï¼Œç”Ÿé•¿æ¿€ç´ ä¸æ˜¯EPOçš„åˆ«åã€‚'
Â  Â  },
Â  Â  {
Â  Â  Â  type: 'choice',
Â  Â  Â  question: 'EPOæ»¥ç”¨å¯èƒ½å¯¼è‡´çš„åæœæœ‰ï¼š',
Â  Â  Â  options: [
Â  Â  Â  Â  'A. è¡€å‹è¿‡é«˜å’Œå¿ƒè„ç—…',
Â  Â  Â  Â  'B. è´«è¡€å’Œä½è¡€å‹',
Â  Â  Â  Â  'C. é£Ÿæ¬²ä¸æŒ¯',
Â  Â  Â  Â  'D. è§†åŠ›ä¸‹é™'
Â  Â  Â  ],
Â  Â  Â  answer: 'A',
Â  Â  Â  explanation: 'æ ¹æ®çŸ¥è¯†ç‚¹ä¸‰ï¼ŒEPOæ»¥ç”¨ä¼šå¯¼è‡´è¡€å‹è¿‡é«˜å’Œå¿ƒè„ç—…ç­‰ä¸¥é‡åæœã€‚'
Â  Â  },
Â  Â  {
Â  Â  Â  type: 'true_false',
Â  Â  Â  question: 'EPOé€šè¿‡"é”é’¥ç»“åˆ"çš„æ–¹å¼ä¸çº¢ç³»ç¥–ç»†èƒè¡¨é¢çš„ç‰¹å¼‚æ€§å—ä½“ç»“åˆæ¥å‘æŒ¥ä½œç”¨ã€‚',
Â  Â  Â  answer: true,
Â  Â  Â  explanation: 'æ ¹æ®çŸ¥è¯†ç‚¹äºŒï¼ŒEPOç¡®å®æ˜¯é€šè¿‡ä¸çº¢ç³»ç¥–ç»†èƒè¡¨é¢çš„ç‰¹å¼‚æ€§å—ä½“"é”é’¥ç»“åˆ"æ¥å‘æŒ¥å…¶ç”Ÿç‰©æ´»æ€§ã€‚'
Â  Â  },
Â  Â  {
Â  Â  Â  type: 'true_false',
Â  Â  Â  question: 'EPOæ»¥ç”¨å¯¹äººä½“æ²¡æœ‰ä»»ä½•å±å®³ã€‚',
Â  Â  Â  answer: false,
Â  Â  Â  explanation: 'æ ¹æ®çŸ¥è¯†ç‚¹ä¸‰ï¼ŒEPOæ»¥ç”¨ä¼šå¯¼è‡´å¤šç§ä¸¥é‡çš„å¥åº·é£é™©ï¼ŒåŒ…æ‹¬è¡€æ¶²çº¢ç»†èƒè¿‡å¤šã€è¡€å‹è¿‡é«˜ã€å¿ƒè„ç—…å’Œä¸­é£ç­‰ã€‚'
Â  Â  }
Â  ];

Â  let currentQuestionIndex = 0;
Â  let quizCompleted = false;

Â  // --- ADDED FOR MOBILE PLAYBACK: Start Button Logic ---
Â  startButton.onclick = function() {
Â  Â  startOverlay.style.display = 'none'; // Hide the overlay
Â  Â  
Â  Â  // Attempt to play the video.
Â  Â  // This is a user-initiated gesture, so it should work on mobile.
Â  Â  var playPromise = video.play();

Â  Â  if (playPromise !== undefined) {
Â  Â  Â  playPromise.then(_ => {
Â  Â  Â  Â  // Autoplay started!
Â  Â  Â  Â  console.log("Video playback started by user gesture.");
Â  Â  Â  }).catch(error => {
Â  Â  Â  Â  // Autoplay was prevented.
Â  Â  Â  Â  console.error("Video play failed:", error);
Â  Â  Â  Â  // Show the controls so user can manually play
Â  Â  Â  Â  video.controls = true; 
Â  Â  Â  });
Â  Â  }
Â  };
Â  // --- END OF ADDED JAVASCRIPT ---


Â  // --- Event Listener for Video Time Updates ---
Â  video.ontimeupdate = function () {
Â  Â  if (quizCompleted) return; // Stop checking time if quiz is done
Â  Â  const time = video.currentTime;

Â  Â  // Timestamps converted to seconds (MM:SS.ms -> seconds)
Â  Â  const timeKp1 = 14.25; // 00:14.25
Â  Â  const timeKp2 = 79.81; // 01:19.81
Â  Â  const timeKp3 = 100.62; // 01:40.62
Â  Â  const timeSummary = 123.57; // 02:03.57
Â  Â  const timeFinalQuiz = 195.21; // 03:15.21

Â  Â  // Original popup triggers (kept for now)
Â  Â  if (time >= 59.31 && !popupShown) { // 00:59.31
Â  Â  Â  video.pause();
Â  Â  Â  popup.style.display = 'block';
Â  Â  Â  popupShown = true;
Â  Â  }
Â  Â  // åˆ é™¤äº†01:49.54æ—¶é—´ç‚¹çš„é€‰æ‹©é¢˜äº¤äº’å¼¹çª—
Â  Â  if (time >= 174.76 && !finalPopupShown) { // 02:54.76
Â  Â  Â  video.pause();
Â  Â  Â  finalPopup.style.display = 'block';
Â  Â  Â  finalPopupShown = true;
Â  Â  }
Â  Â  if (time >= 182.41 && time < 183 && !hasInteractedWithQR && !firstQRTriggered) { // 03:02.41
Â  Â  Â  showQr(false);
Â  Â  Â  firstQRTriggered = true;
Â  Â  }

Â  Â  // New popup triggers
Â  Â  if (time >= timeKp1 && !knowledgePopup1Shown) {
Â  Â  Â  showKnowledgePopup('knowledgePopup1');
Â  Â  Â  knowledgePopup1Shown = true;
Â  Â  }
Â  Â  if (time >= timeKp2 && !knowledgePopup2Shown) {
Â  Â  Â  showKnowledgePopup('knowledgePopup2');
Â  Â  Â  knowledgePopup2Shown = true;
Â  Â  }
Â  Â  if (time >= timeKp3 && !knowledgePopup3Shown) {
Â  Â  Â  showKnowledgePopup('knowledgePopup3');
Â  Â  Â  knowledgePopup3Shown = true;
Â  Â  }
Â  Â  if (time >= timeSummary && !summaryPopupShown) {
Â  Â  Â  showKnowledgePopup('summaryPopup');
Â  Â  Â  summaryPopupShown = true;
Â  Â  }
Â  Â  // æœ€ç»ˆæµ‹éªŒå¼¹çª—ä¸å†ä½¿ç”¨å›ºå®šæ—¶é—´ç‚¹è§¦å‘ï¼Œè€Œæ˜¯åœ¨å…³é—­è¯¾å ‚å°ç»“å¼¹çª—åè§¦å‘
Â  };

Â  video.onended = function () {
Â  Â  if (!quizCompleted) {
Â  Â  Â  Â  // If video ends before quiz is triggered/completed, show quiz
Â  Â  Â  Â  showKnowledgePopup('finalQuizPopup');
Â  Â  Â  Â  if (!finalQuizPopupShown) {
Â  Â  Â  Â  Â  Â  loadQuizQuestion(currentQuestionIndex);
Â  Â  Â  Â  Â  Â  finalQuizPopupShown = true;
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  // Or show the original QR code if quiz is done
Â  Â  Â  Â  showQr(true);
Â  Â  }
Â  };

Â  // --- Functions for Original Popups ---
Â  function closePopup() {
Â  Â  playClickSound(); // Add click sound
Â  Â  popup.style.display = 'none';
Â  Â  video.play();
Â  }
Â  function checkAnswer(answer) { // Original quiz logic
Â  Â  if (answer === 'B') {
Â  Â  Â  feedback.textContent = 'BINGOï¼ç­”å¯¹å•¦ ğŸ‰';
Â  Â  Â  feedback.style.color = '#00aa00';
Â  Â  Â  showConfetti();
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  quiz.style.display = 'none';
Â  Â  Â  Â  video.play();
Â  Â  Â  }, 1500);
Â  Â  } else {
Â  Â  Â  feedback.textContent = 'é”™è¯¯ï¼è§£æï¼š' + getExplanation(answer);
Â  Â  Â  feedback.style.color = 'red';
Â  Â  }
Â  }
Â  function getExplanation(answer) { // Original explanation logic
Â  Â  const explanations = {
Â  Â  Â  'A': 'EPOå±äºå…´å¥‹å‰‚ï¼Œæ˜¯è¢«å›½é™…ä½“è‚²ç»„ç»‡æ˜ä»¤ç¦æ­¢çš„éæ³•è¯ç‰©ã€‚',
Â  Â  Â  'C': 'ä½¿ç”¨EPOä¼šå¯¼è‡´ä¸¥é‡çš„å‰¯ä½œç”¨ï¼Œå¦‚è¡€æ¶²æµ“ç¨ ã€è¡€æ “å½¢æˆç­‰ã€‚',
Â  Â  Â  'D': 'EPOçš„ä½¿ç”¨å¯¹è¿åŠ¨å‘˜æ¥è¯´æœ‰ä¸¥é‡çš„å¥åº·é£é™©ã€‚'
Â  Â  };
Â  Â  return explanations[answer] || '';
Â  }
Â  function showCommitment() {
Â  Â  finalPopup.style.display = 'none';
Â  Â  commitmentPopup.style.display = 'block';
section
Â  }
Â  function closeCommitment() {
Â  Â  commitmentPopup.style.display = 'none';
Â  Â  video.play();
Â  }
Â  function showQr(showFull) {
Â  Â  qrContainer.style.display = 'block';
Â  Â  video.pause();
Â  Â  lastVideoTime = video.currentTime;
Â  Â  qrDownload.style.display = showFull ? 'inline-block' : 'none';
Â  }
Â  function closeQr() {
Â  Â  qrContainer.style.display = 'none';
Â  Â  hasInteractedWithQR = true;
Â  Â  video.currentTime = lastVideoTime;
Â  Â  video.play();
Â  }
Â  function showConfetti() { // Original confetti
Â  Â  for (let i = 0; i < 40; i++) {
Â  Â  Â  const confetti = document.createElement('div');
Â  Â  Â  confetti.classList.add('confetti');
Â  Â  Â  confetti.style.left = Math.random() * 100 + 'vw';
Â  Â  Â  confetti.style.backgroundColor = randomColor();
Â  Â  Â  confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
Â  Â  Â  document.body.appendChild(confetti);
Â  Â  Â  setTimeout(() => confetti.remove(), 3000);
Â  Â  }
Â  }
Â  function randomColor() { // Original random color
Â  Â  const colors = ['#ffcc00', '#ff6666', '#66ccff', '#0033cc', '#ff0000'];
Â  Â  return colors[Math.floor(Math.random() * colors.length)];
Â  }

Â  // --- Sound Effect Functions ---
Â  function playClickSound() {
Â  Â  const clickSound = new Audio("button_click.mp3");
Â  Â  clickSound.play();
Â  }

Â  function playNotificationSound() {
Â  Â  const notificationSound = new Audio("notification_popup.mp3");
Â  Â  notificationSound.play();
Â  }

Â  function playCorrectAnswerSound() { // New function for correct answer sound
Â  Â  const correctSound = new Audio("correct_answer_applause.mp3");
Â  Â  correctSound.play();
Â  }

Â  // --- Functions for New Popups ---
Â  function showKnowledgePopup(popupId) {
Â  Â  const popupElement = document.getElementById(popupId);
Â  Setting up the development environment
Â  Â  if (popupElement) {
Â  Â  Â  playNotificationSound(); // Play notification sound when popup appears
Â  Â  Â  video.pause();
Â  Â  Â  popupElement.style.display = "flex"; // Use flex for centering
Â  Â  Â  
Â  Â  Â  // Trigger speech synthesis for knowledge/summary popups
Â  Â  Â  if (popupId.startsWith("knowledge") || popupId === "summaryPopup") {
Â  Â  Â  Â  Â  const contentElement = popupElement.querySelector("[data-speech]");
Â  Â  Â  Â  Â  if (contentElement) {
Â  Â  Â  Â  Â  Â  Â  const textToSpeak = contentElement.getAttribute("data-speech");
Â  Â  Â  Â  Â  Â  Â  // No callback needed here as we don't need to do anything after speech
Â  Â  Â  Â  Â  Â  Â  speakText(textToSpeak);
Â  Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  }

Â  function closeKnowledgePopup(popupId) {
Â  Â  playClickSound(); // Play click sound when closing
Â  Â  const popupElement = document.getElementById(popupId);
Â  Â  if (popupElement) {
Â  Â  Â  popupElement.style.display = "none";
Â  Â  Â  // Stop speech synthesis when closing popup
Â  Â  Â  if (synth.speaking) {
Â  Â  Â  Â  Â  synth.cancel();
Â  Â  Â  }

Â  Â  Â  // å¦‚æœå…³é—­çš„æ˜¯è¯¾å ‚å°ç»“å¼¹çª—ï¼Œåˆ™æ˜¾ç¤ºæœ€ç»ˆæµ‹éªŒå¼¹çª—
iÂ  Â  Â  if (popupId === "summaryPopup" && !finalQuizPopupShown) {
Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  showKnowledgePopup('finalQuizPopup'); // showKnowledgePopup already plays notification sound
Â  Â  Â  Â  Â  Â  Â  loadQuizQuestion(currentQuestionIndex);
Â  Â  Â  Â  Â  Â  Â  finalQuizPopupShown = true;
Â  Â  Â  Â  Â  }, 500); // çŸ­æš‚å»¶è¿Ÿåæ˜¾ç¤ºæµ‹éªŒå¼¹çª—
Â  Â  Â  } else if (!quizCompleted || popupId !== "finalQuizPopup") { // å…¶ä»–æƒ…å†µä¸‹ç»§ç»­æ’­æ”¾è§†é¢‘
Â  Â  Â  Â  Â  video.play();
Â  Â  Â  }
Â  Â  }
Â  }

Â  // --- Speech Synthesis Function ---
Â  // Add callback parameter
Â  function speakText(text, callback) {
Â  Â  if (synth.speaking) {
Â  Â  Â  Â  // console.log('SpeechSynthesis is busy, cancelling previous speech.');
Â  Â  Â  Â  synth.cancel(); // Cancel previous speech if any
Â  Â  Â  Â  // Use a small timeout to allow cancellation to complete before starting new speech
Â  Â  Â  Â  // Pass the callback to the new startSpeaking call
Â  Â  Â  Â  setTimeout(() => { startSpeaking(text, callback); }, 100);
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  // Pass the callback to startSpeaking
Â  Â  startSpeaking(text, callback);
Â  }

Â  // Add callback parameter
Â  function startSpeaking(text, callback) {
Â  Â  if (text !== "") {
Â  Â  Â  Â  speechUtterance = new SpeechSynthesisUtterance(text);
Â  Â  Â  Â  speechUtterance.onend = function (event) {
Â  Â  Â  Â  Â  Â  // console.log("SpeechSynthesisUtterance.onend");
Â  Â  Â  Â  Â  Â  speechUtterance = null; // Clear utterance when finished
Â  Â  Â  Â  Â  Â  // Execute the callback function if it exists
Â  Â  Â  Â  Â  Â  if (typeof callback === "function") {
Â  Â  Â  Â  Â  Â  Â  Â  callback();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  speechUtterance.onerror = function (event) {
Â  Â  Â  Â  Â  Â  console.error("SpeechSynthesisUtterance.onerror", event);
Â  Â  Â  Â  Â  Â  speechUtterance = null;
Â  Â  Â  Â  Â  Â  // Optionally call callback even on error, or handle differently
Â  Â  Â  Â  Â  Â  // if (typeof callback === "function") {
Â  Â  Â  Â  Â  Â  // Â  Â  callback(); 
Â  Â  Â  Â  Â  Â  // }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Try to find a suitable Chinese voice (preference for female/youthful if possible)
Â  Â  Â  Â  let selectedVoice = voices.find(voice => voice.lang === "zh-CN" && voice.name.includes("Xiaoyi")) || // Common youthful voice name
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  voices.find(voice => voice.lang === "zh-CN" && voice.name.includes("Female")) ||
section
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  voices.find(voice => voice.lang === "zh-CN") || // Any Chinese voice
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  voices.find(voice => voice.lang.startsWith("zh")); // Any Chinese variant

Â  Â  Â  Â  if (selectedVoice) {
Â  Â  Â  Â  Â  Â  speechUtterance.voice = selectedVoice;
Â  Â  Â  Â  Â  Â  // console.log("Using voice:", selectedVoice.name);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.warn("No suitable Chinese voice found, using default.");
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Optional: Adjust pitch and rate
Â  Â  Â  Â  // speechUtterance.pitch = 1; 
Â  Â  Â  Â  // speechUtterance.rate = 1;

Â  Â  Â  Â  synth.speak(speechUtterance);
Â  Â  }
Â  }


Â  // --- Quiz Logic Functions ---
Â  function loadQuizQuestion(index) {
Â  Â  if (index >= quizData.length) {
Â  Â  Â  completeQuiz();
Â  Â  Â  return;
Â  Â  }

Â  Â  const questionData = quizData[index];
Â  Â  quizContainer.innerHTML = ''; // Clear previous question

Â  Â  const questionBox = document.createElement('div');
Â  Â  questionBox.className = 'quiz-question-box';

Â  Â  const questionText = document.createElement('p');
Â  Â  questionText.textContent = `ç¬¬ ${index + 1} é¢˜: ${questionData.question}`;
Â  Â  questionBox.appendChild(questionText);

Â  Â  if (questionData.type === 'choice') {
Â  Â  Â  questionData.options.forEach(optionText => {
Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  button.className = 'quiz-option';
Â  Â  Â  Â  button.textContent = optionText;
Â  Â  Â  Â  const choice = optionText.split('')[0]; // Get A, B, C, or D
Â  Â  Â  Â  button.onclick = () => { playClickSound(); handleAnswer(choice, questionData.answer, questionData.explanation, questionBox); };
Â  Â  Â  Â  questionBox.appendChild(button);
Â  Â  Â  });
Â  Â  } else if (questionData.type === 'true_false') {
Â  Â  Â  const trueButton = document.createElement('button');
Â  Â  Â  trueButton.className = 'quiz-option';
Â  Â  Â  trueButton.textContent = 'å¯¹';
Â  Â  Â  trueButton.onclick = () => { playClickSound(); handleAnswer(true, questionData.answer, questionData.explanation, questionBox); };
Â  Â  Â  questionBox.appendChild(trueButton);

Â  Â  Â  const falseButton = document.createElement('button');
Â  Â  Â  falseButton.className = 'quiz-option';
Â  Â  Â  falseButton.textContent = 'é”™';
Â  Â  Â  falseButton.onclick = () => { playClickSound(); handleAnswer(false, questionData.answer, questionData.explanation, questionBox); };
Â  Â  Â  questionBox.appendChild(falseButton);
Â  Â  }

Â  Â  const feedbackElement = document.createElement('p');
Â  Â  feedbackElement.className = 'quiz-feedback';
Â  Â  questionBox.appendChild(feedbackElement);

Â  Â  const navigationElement = document.createElement('p');
Â  Â  navigationElement.className = 'quiz-navigation';
Â  Â  navigationElement.style.display = 'none'; // Hide initially
Â  Â  navigationElement.textContent = 'è¯·ç»§ç»­ä½œç­”ä¸‹ä¸€é¢˜...';
Â  Â  questionBox.appendChild(navigationElement);

Â  Â  quizContainer.appendChild(questionBox);
Â  Â  quizContainer.scrollTop = quizContainer.scrollHeight; // Scroll to the new question
Â  }

Â  function handleAnswer(selectedAnswer, correctAnswer, explanation, questionBox) {
Â  Â  const feedbackElement = questionBox.querySelector("p.quiz-feedback");
Â  Â  const navigationElement = questionBox.querySelector("p.quiz-navigation");
Â  Â  const buttons = questionBox.querySelectorAll("button.quiz-option");

Â  Â  // Disable buttons after answering
Â  Â  buttons.forEach(button => button.disabled = true);

Â  Â  let correctSpeech = "ç­”å¯¹äº†ï¼çœŸä¸é”™ï¼ä¸ºä½ é¼“æŒï¼";
sÂ  Â  let incorrectSpeech = "ä¸å¯¹å“¦ï¼Œå›é¡¾ä¸€ä¸‹çŸ¥è¯†ç‚¹ï¼Œå†è¯•è¯•ï¼";

Â  Â  // ä¸ºç¬¬ä¸€é¢˜å®šåˆ¶æ’­æŠ¥å†…å®¹
Â  Â  if (currentQuestionIndex === 0) {
Â  Â  Â  Â  correctSpeech = "ç­”å¯¹äº†ï¼Bé€‰é¡¹æ­£ç¡®æè¿°äº†EPOçš„ä¸»è¦ç”Ÿç†åŠŸèƒ½ã€‚";
Â  Â  Â  Â  // å¯¹äºç¬¬ä¸€é¢˜çš„é”™è¯¯å›ç­”ï¼Œæ’­æŠ¥è§£æå†…å®¹
Â  Â  Â  Â  incorrectSpeech = "ä¸å¯¹å“¦ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯Bã€‚è§£æï¼š" + explanation;
Â  Â  }

Â  Â  // æ£€æŸ¥ç­”æ¡ˆ (æ³¨æ„ï¼šåŸå§‹ç¬¬ä¸€é¢˜ç­”æ¡ˆæ˜¯Bï¼Œåç»­é¢˜ç›®å¯èƒ½æœ‰ä¸åŒç±»å‹ç­”æ¡ˆ)
Â  Â  let isCorrect = false;
Â  Â  if (Array.isArray(correctAnswer)) { // å¤„ç†å¤šé€‰é¢˜
Â  Â  Â  Â  // æ³¨æ„ï¼šå½“å‰ä»£ç æœªå®Œå…¨æ”¯æŒå¤šé€‰é€»è¾‘åˆ¤æ–­ï¼Œè¿™é‡Œä»…ä½œç¤ºä¾‹
sÂ  Â  Â  Â  isCorrect = correctAnswer.includes(String(selectedAnswer)); 
Â  Â  } else { // å¤„ç†å•é€‰æˆ–åˆ¤æ–­é¢˜
Â  Â  Â  Â  isCorrect = String(selectedAnswer) === String(correctAnswer);
Â  Â  }

Â  Â  if (isCorrect) {
Â  Â  Â  playCorrectAnswerSound(); // Play sound for correct answer
Â  Â  Â  feedbackElement.textContent = "æ­£ç¡®ï¼ğŸ‘ å¹²å¾—æ¼‚äº®ï¼" + explanation;
Â  Â  Â  feedbackElement.className = "quiz-feedback correct";
Â  Â  Â  
Â  Â  Â  const nextAction = () => {
Â  Â  Â  Â  Â  currentQuestionIndex++;
Â  Â  Â  Â  Â  if (currentQuestionIndex < quizData.length) {
Â  Â  Â  Â  Â  Â  Â  navigationElement.style.display = "block";
Â  Â  Â  Â  Â  Â  Â  loadQuizQuestion(currentQuestionIndex); 
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  completeQuiz();
Â  Â  Â  Â  Â  }
Â  Â  Â  };

Â  Â  Â  speakText(correctSpeech, nextAction);

Â  Â  } else {
Â  Â  Â  feedbackElement.textContent = "é”™è¯¯ï¼ğŸ˜¥ å†è¯•ä¸€æ¬¡å§ï¼è§£æï¼š" + explanation;
Â  Â  Â  feedbackElement.className = "quiz-feedback incorrect";
Â  Â  Â  speakText(incorrectSpeech);
Â  Â  Â  // å…è®¸é‡è¯•
Â  Â  Â  buttons.forEach(button => button.disabled = false);
Section 7: {Setting up the development environment}
Â  Â  }
Â  }

Â  function completeQuiz() {
Â  Â  quizCompleted = true;
Â  Â  quizContainer.innerHTML = '<h3 style="color: #00ff00;">æ‰€æœ‰é¢˜ç›®å·²å®Œæˆï¼</h3>';
Â  Â  quizCloseButton.style.display = 'block'; // Show close button
Â  Â  showCelebration();
Â  Â  // Pass a callback to ensure UI actions happen after speech completes
Â  Â  speakText('æ­å–œä½ ï¼å·²å®Œæˆå…¨éƒ¨è¯¾å ‚å†…å®¹å’Œä¹ é¢˜ï¼', () => {
Â  Â  Â  // Optional: Any actions that should happen after completion speech ends
Â  Â  Â  console.log("Quiz completion speech finished");
Â  Â  });
Â  }

Â  function showCelebration() {
Â  Â  Â  celebrationEffect.style.display = 'flex';
Â  Â  Â  // Play sound effect
Â  Â  Â  const celebrationSound = new Audio('celebration_applause.mp3');
Â  Â  Â  celebrationSound.play();
Â  Â  Â  // Optional: Hide after a few seconds
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  celebrationEffect.style.display = 'none';
Â  Â  Â  }, 4000); // Display for 4 seconds
Â  }

</script>

</body>
</html>